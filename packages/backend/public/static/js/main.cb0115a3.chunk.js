(this["webpackJsonpfrontend-v2"]=this["webpackJsonpfrontend-v2"]||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){},102:function(e,t,a){},103:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(27),l=a.n(c),u=a(5),i=a(10),o=a(3),s=a(107),m=a(2),d=a.n(m),b=a(6);function p(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],c=a[1],l=Object(n.useCallback)(Object(b.a)(d.a.mark((function t(){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.service.getAll();case 2:(a=t.sent)&&c(a.data);case 4:case"end":return t.stop()}}),t)}))),[e.service]);return Object(n.useEffect)((function(){l()}),[l]),[r,l]}var v=a(19),f=a(22),E=a(56),h=a.n(E);function g(e,t){return O.apply(this,arguments)}function O(){return(O=Object(b.a)(d.a.mark((function e(t,a){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T("auth/login",{username:t,password:a});case 2:return n=e.sent,N((r=null===n||void 0===n?void 0:n.data).token),y(r.user),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){e&&localStorage.setItem("LS_USER_INFO",JSON.stringify(e))}function j(){var e=localStorage.getItem("LS_USER_INFO");return e?JSON.parse(e):null}function N(e){if(!e)throw Error("no_token_defined");localStorage.setItem("LS_TOKEN",e)}function w(){return localStorage.getItem("LS_TOKEN")}var k;function x(e,t){return S.apply(this,arguments)}function S(){return(S=Object(b.a)(d.a.mark((function e(t,a){var n,r,c,l=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=l.length>2&&void 0!==l[2]?l[2]:void 0,r=h.a.create({baseURL:"/api/"}),(c=w())&&(r.defaults.headers.common.Authorization="Bearer ".concat(c)),e.t0=a,e.next=e.t0===k.GET?7:e.t0===k.POST?8:e.t0===k.PUT?9:e.t0===k.PATCH?10:e.t0===k.DELETE?11:12;break;case 7:return e.abrupt("return",r.get(t,{params:n}));case 8:return e.abrupt("return",r.post(t,n));case 9:return e.abrupt("return",r.put(t,n));case 10:return e.abrupt("return",r.patch(t,n));case 11:return e.abrupt("return",r.delete(t));case 12:return e.abrupt("break",13);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return x(e,k.GET,t)}function T(e,t){return x(e,k.POST,t)}!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.PATCH="PATCH",e.DELETE="DELETE"}(k||(k={}));var C,F=function(){function e(t){Object(v.a)(this,e),this.resourceURL=t}return Object(f.a)(e,[{key:"getAll",value:function(){return P(this.resourceURL)}},{key:"getByID",value:function(e){return P("".concat(this.resourceURL,"/").concat(e))}},{key:"add",value:function(e){return T(this.resourceURL,e)}},{key:"update",value:function(e,t){return function(e,t){return x(e,k.PUT,t)}("".concat(this.resourceURL,"/").concat(e),t)}},{key:"delete",value:function(e){return x("".concat(this.resourceURL,"/").concat(e),k.DELETE)}}]),e}(),A=new F("members"),I=a(30),D=a(106),L=a(111),R=a(105),q=a(110),B=function(e){var t=e.column,a=t.filterValue,n=t.preFilteredRows,c=t.setFilter,l=n.length;return r.a.createElement(R.a,{className:"mb-3"},r.a.createElement(R.a.Append,null,r.a.createElement(R.a.Text,null,"\ud83d\udd0e")),r.a.createElement(q.a,{value:a||"",onChange:function(e){c(e.target.value||void 0)},placeholder:"Search ".concat(l," records...")}))},U=function(e){var t=Object(n.useMemo)((function(){return e.data}),[e.data]),a=Object(n.useMemo)((function(){return e.columns}),[e.columns]),c=r.a.useMemo((function(){return{text:function(e,t,a){return e.filter((function(e){var n=e.values[t];return void 0===n||String(n).toLowerCase().startsWith(String(a).toLowerCase())}))}}}),[]),l=r.a.useMemo((function(){return{Filter:B}}),[]),u=Object(I.useTable)({columns:a,data:t,defaultColumn:l,filterTypes:c,initialState:{pageIndex:0,pageSize:e.pageSize||20}},I.useFilters,I.useSortBy,I.usePagination),i=u.getTableProps,o=u.getTableBodyProps,s=u.headerGroups,m=u.page,d=u.pageCount,b=u.gotoPage,p=u.prepareRow,v=u.state.pageIndex;return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,Object.assign({id:e.id,className:e.className},i()),r.a.createElement("thead",null,s.map((function(e){return r.a.createElement("tr",e.getHeaderGroupProps(),e.headers.map((function(e){return r.a.createElement("th",e.getHeaderProps(),r.a.createElement(H,{column:e}),r.a.createElement(G,{column:e}))})))}))),r.a.createElement("tbody",o(),m.map((function(t){p(t);var a=e.customRowProps?e.customRowProps(t):{};return r.a.createElement("tr",t.getRowProps(a),t.cells.map((function(e){return r.a.createElement("td",e.getCellProps(),e.render("Cell"))})))})))),r.a.createElement(_,{pageCount:d,current:v,gotoPage:b}))},_=function(e){for(var t=e.current,a=[],n=function(n){a.push(r.a.createElement(L.a.Item,{key:n,active:n-1===t,onClick:function(){return e.gotoPage(n-1)}},n))},c=1;c<=e.pageCount;c++)n(c);return r.a.createElement(L.a,null,t-1>=0&&r.a.createElement(L.a.Prev,{onClick:function(){return e.gotoPage(t-1)}}),a,t+1<e.pageCount&&r.a.createElement(L.a.Next,{onClick:function(){return e.gotoPage(t+1)}}))},H=function(e){var t=e.column;return r.a.createElement("div",t.getSortByToggleProps(),t.render("Header"),r.a.createElement("span",null,t.isSorted?t.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""))},G=function(e){var t=e.column;return r.a.createElement("div",null,t.canFilter?t.render("Filter"):null)},M=(a(94),function(){var e=p({service:A}),t=Object(o.a)(e,1)[0],a=[{Header:"Nom",accessor:"name"},{Header:"",accessor:"id",disableFilters:!0,disableSortBy:!0,Cell:function(e){return r.a.createElement(V,{id:e.value})}}],c=Object(n.useMemo)((function(){return t.map((function(e){var t,a;return{id:e.id,name:"".concat(null===(t=e.user)||void 0===t?void 0:t.firstname," ").concat(null===(a=e.user)||void 0===a?void 0:a.lastname),negativeBalance:e.balance<0}}))}),[t]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Membres"),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement(u.b,{to:"/admin/members/add",className:"btn btn-primary"},"Ajouter")),r.a.createElement("div",{className:"row"},r.a.createElement(U,{data:c,columns:a,customRowProps:function(e){return{className:c[e.index].negativeBalance?"member-table__row--negative-balance":""}}}))))}),V=function(e){return r.a.createElement(u.b,{component:s.a,to:"/admin/members/".concat(e.id)},"...")},W=a(8),J=a(9),Y=a(109),z=new F("clubs"),K=new F("memberlabels"),Q=a(25),$=a(23),X=new(function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){return Object(v.a)(this,a),t.call(this,"membership-plans")}return Object(f.a)(a,[{key:"getAllTypes",value:function(){return P("membership-plans/types")}}]),a}(F)),Z=function(e){var t=e.className,a=e.label,n=e.type,c=e.formnikError,l=e.name;return r.a.createElement("div",{className:"form-group ".concat(t)},r.a.createElement("label",null,a),r.a.createElement(J.b,{className:"form-control ".concat(c?"is-invalid":""),name:l,type:n}),r.a.createElement(J.a,{name:l,component:"div",className:"invalid-feedback"}))},ee=a(33),te=a.n(ee);!function(e){e[e.weekly=0]="weekly",e[e.monthly=1]="monthly",e[e.quarterly=2]="quarterly",e[e.biannual=3]="biannual",e[e.annual=4]="annual"}(C||(C={}));var ae,ne=function(e){switch(e){case C.weekly:return"hebdomadaire";case C.monthly:return"mensuel";case C.quarterly:return"trimestriel";case C.biannual:return"semestriel";case C.annual:return"annuel";default:return"sp\xe9cial"}},re=function(e,t){var a=te()();switch(t){case C.weekly:a.add(1,"weeks");break;case C.monthly:a.add(1,"months");break;case C.quarterly:a.add(3,"months");break;case C.biannual:a.add(6,"months");break;case C.annual:a.add(1,"years");break;default:console.log("not a valid type")}return a.toDate()},ce=function(e){var t,a,c=Object(n.useState)(!1),l=Object(o.a)(c,2),m=l[0],v=l[1],f=p({service:K}),E=Object(o.a)(f,1)[0],h=p({service:z}),g=Object(o.a)(h,1)[0],O=p({service:X}),y=Object(o.a)(O,2),j=y[0],N=(y[1],Object(n.useState)("0")),w=Object(o.a)(N,2),k=w[0],x=w[1],S=Object(n.useState)(te()().format("YYYY-MM-DD")),P=Object(o.a)(S,2),T=P[0],C=P[1],F=Object(i.g)(),I={memberLabels:[],club:void 0,user:{email:"",firstname:"",lastname:"",birthdate:"",phone:"",street:"",streetNumber:void 0,city:"",postalCode:void 0},global:""};e.member&&(I.memberLabels=(null===(t=e.member.memberLabels)||void 0===t?void 0:t.map((function(e){return e.id})))||[],I.club=null===(a=e.member.club)||void 0===a?void 0:a.id,I.user=Object(W.a)(Object(W.a)({},I.user),e.member.user),console.log(I));var D=function(){var t=Object(b.a)(d.a.mark((function t(a,n){var r,c,l,u;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.setSubmitting,c=n.setFieldError,t.prev=1,a=Object(W.a)(Object(W.a)({},a),{},{memberLabels:a.memberLabels.map((function(e){return E.find((function(t){return t.id===Number.parseInt(e)}))}))}),u=j.find((function(e){return e.id===parseInt(k)})),!(null===(l=e.member)||void 0===l?void 0:l.id)){t.next=9;break}return t.next=7,A.update(e.member.id,a);case 7:t.next=12;break;case 9:return t.next=11,A.add(Object(W.a)(Object(W.a)({},a),{},{organisation:{id:e.organisationID},memberships:u?[{startDate:new Date(T),endDate:re(new Date(T),null===u||void 0===u?void 0:u.type),plan:u}]:[]}));case 11:t.sent;case 12:L(),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(1),console.error(t.t0),t.t0.message?c("global",t.t0.message):c("global","Erreur serveur...");case 19:r(!1);case 20:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e,a){return t.apply(this,arguments)}}(),L=function(){F.push("/admin/members")},R=function(){var t;return!!(null===(t=e.member)||void 0===t?void 0:t.id)};return r.a.createElement(J.d,{initialValues:I,validate:function(e){var t={};return e.user.email||(t.user=Object(W.a)({},t.user),t.user.email="Requis"),e.user.birthdate||(t.user=Object(W.a)({},t.user),t.user.birthdate="Requis"),t},onSubmit:D},(function(e){var t,a,n,c,l,i,o,d,b,p=e.isSubmitting,f=e.errors;e.setFieldValue,e.values;return r.a.createElement(J.c,null,m&&r.a.createElement(Y.a,{variant:"success",onClose:function(){return v(!1)},dismissible:!0},"Le membre a bien \xe9t\xe9 sauv\xe9 !"),r.a.createElement(J.a,{name:"global",component:function(e){return r.a.createElement(Y.a,{variant:"danger"},e.children)}}),r.a.createElement("div",null,r.a.createElement("h2",null,"Tag"),r.a.createElement(J.b,{component:"select",multiple:!0,name:"memberLabels",className:"form-control"},E.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.name)}))),r.a.createElement("h2",null,"Club"),r.a.createElement(J.b,{component:"select",multiple:!1,name:"club",className:"form-control"},g.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.name)}))),r.a.createElement("h2",null,"Informations g\xe9n\xe9rales"),r.a.createElement(Z,{label:"Email",type:"text",formnikError:null===(t=f.user)||void 0===t?void 0:t.email,name:"user.email"}),r.a.createElement(Z,{label:"Nom",type:"text",formnikError:null===(a=f.user)||void 0===a?void 0:a.lastname,name:"user.lastname"}),r.a.createElement(Z,{label:"Pr\xe9nom",type:"text",formnikError:null===(n=f.user)||void 0===n?void 0:n.firstname,name:"user.firstname"}),r.a.createElement(Z,{label:"Date de naissance",type:"date",formnikError:null===(c=f.user)||void 0===c?void 0:c.birthdate,name:"user.birthdate"}),r.a.createElement(Z,{label:"T\xe9l\xe9phone",type:"text",formnikError:null===(l=f.user)||void 0===l?void 0:l.phone,name:"user.phone"}),r.a.createElement("h2",null,"Adresse"),r.a.createElement("div",{className:"form-row"},r.a.createElement(Z,{className:"col-8",label:"Rue",type:"text",formnikError:null===(i=f.user)||void 0===i?void 0:i.street,name:"user.street"}),r.a.createElement(Z,{className:"col",label:"Num\xe9ro",type:"number",formnikError:null===(o=f.user)||void 0===o?void 0:o.streetNumber,name:"user.streetNumber"})),r.a.createElement("div",{className:"form-row"},r.a.createElement(Z,{className:"col-4",label:"NPA",type:"number",formnikError:null===(d=f.user)||void 0===d?void 0:d.postalCode,name:"user.postalCode"}),r.a.createElement(Z,{className:"col",label:"Ville",type:"text",formnikError:null===(b=f.user)||void 0===b?void 0:b.city,name:"user.city"})),r.a.createElement("h2",null,"Abonnement"),r.a.createElement("div",{className:"form-row",hidden:R()},r.a.createElement(J.b,{as:"select",name:"membershipSelect",onChange:function(e){var t;t=e.target.value,x(t)}},j.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},"".concat(ne(e.type),", ").concat(e.price,".-"))}))),r.a.createElement(J.b,{name:"startDate",type:"date",onChange:function(e){C(e.target.value)},value:T}))),r.a.createElement(s.a,{variant:"primary",type:"submit",disabled:p},"Sauver"),r.a.createElement(u.b,{to:"/admin/members"},r.a.createElement(s.a,{variant:"secondary"},"Annuler")))}))},le=function(){var e=Object(n.useState)(0),t=Object(o.a)(e,2),a=t[0],r=t[1];return Object(n.useEffect)((function(){var e,t=j();(null===t||void 0===t||null===(e=t.organisation)||void 0===e?void 0:e.id)&&r(null===t||void 0===t?void 0:t.organisation.id)}),[]),[a,r]},ue=function(e){var t,a=Object(i.h)().id,c=Object(n.useState)(null),l=Object(o.a)(c,2),u=l[0],s=l[1],m=le(),p=Object(o.a)(m,1)[0];return Object(n.useEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.getByID(a);case 2:(null===(t=e.sent)||void 0===t?void 0:t.data)&&s(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[a]),u?r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,null===(t=u.user)||void 0===t?void 0:t.email),r.a.createElement(ce,{organisationID:p,member:u})):r.a.createElement(r.a.Fragment,null,"loading...")},ie=function(e){var t=le(),a=Object(o.a)(t,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement(ce,{organisationID:a}))},oe=function(){var e=Object(i.i)().path;return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(e),exact:!0},r.a.createElement(M,null)),r.a.createElement(i.b,{path:"".concat(e,"/add")},r.a.createElement(ie,null)),r.a.createElement(i.b,{path:"".concat(e,"/:id")},r.a.createElement(ue,null)),r.a.createElement(i.a,{to:"".concat(e)}))},se=function(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.getAll();case 2:(t=e.sent)&&c(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Clubs"),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement(u.b,{to:"/admin/clubs/add",className:"btn btn-primary"},"Ajouter")),r.a.createElement("div",{className:"row"},r.a.createElement("table",{className:"table"},r.a.createElement("tbody",null,a.map((function(e){return r.a.createElement(me,{club:e,key:e.id})})))))))},me=function(e){var t=e.club;return r.a.createElement("tr",null,r.a.createElement("td",null,t.id),r.a.createElement("td",null,t.name),r.a.createElement("td",null,r.a.createElement(u.b,{to:"/admin/clubs/".concat(t.id)},"...")))},de=function(e){var t=e.type,a=e.variant,n=e.className,c=e.id,l=e.disabled;return r.a.createElement("button",{type:t||"button",id:c,className:"btn ".concat(a?"btn-".concat(a):""," ").concat(n),disabled:l},e.children)},be=function(e){var t=e.variant,a=e.className,n=e.id;return r.a.createElement("div",{id:n,className:"alert ".concat(t?"alert-".concat(t):""," ").concat(a)},e.children)},pe=function(e){var t=e.club?{name:e.club.name,global:""}:{name:"",global:""},a=function(){var t=Object(b.a)(d.a.mark((function t(a,n){var r,c,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.setSubmitting,c=n.setFieldError,t.prev=1,!(null===(l=e.club)||void 0===l?void 0:l.id)){t.next=7;break}return t.next=5,z.update(e.club.id,a);case 5:t.next=9;break;case 7:return t.next=9,z.add(Object(W.a)(Object(W.a)({},a),{},{organisation:{id:e.organisationID}}));case 9:e.onSubmit(),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),console.error(t.t0),t.t0.message?c("global",t.t0.message):c("global","Erreur serveur...");case 16:r(!1);case 17:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e,a){return t.apply(this,arguments)}}();return r.a.createElement(J.d,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),t},onSubmit:a},(function(e){var t=e.isSubmitting,a=e.errors;return r.a.createElement(J.c,null,r.a.createElement(J.a,{name:"global",component:function(e){return r.a.createElement(be,{variant:"danger"},e.children)}}),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Nom"),r.a.createElement(J.b,{className:"form-control ".concat(a.name?"is-invalid":""),name:"name"}),r.a.createElement(J.a,{name:"name",component:"div",className:"invalid-feedback"})),r.a.createElement(de,{variant:"primary",type:"submit",disabled:t},"Sauver"),r.a.createElement(u.b,{to:"/admin/clubs"},r.a.createElement(de,{variant:"secondary"},"Annuler")))}))},ve=function(e){var t=Object(n.useState)(0),a=Object(o.a)(t,2),c=a[0],l=a[1];Object(n.useEffect)((function(){var e,t=j();(null===t||void 0===t||null===(e=t.organisation)||void 0===e?void 0:e.id)&&l(null===t||void 0===t?void 0:t.organisation.id)}),[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(pe,{organisationID:c,onSubmit:function(){window.history.back()}}))},fe=function(e){var t=Object(n.useState)(0),a=Object(o.a)(t,2),c=a[0],l=a[1],u=Object(i.h)().id,s=Object(n.useState)(null),m=Object(o.a)(s,2),p=m[0],v=m[1];Object(n.useEffect)((function(){var e,t=j();(null===t||void 0===t||null===(e=t.organisation)||void 0===e?void 0:e.id)&&l(null===t||void 0===t?void 0:t.organisation.id)}),[]),Object(n.useEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.getByID(u);case 2:(null===(t=e.sent)||void 0===t?void 0:t.data)&&v(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[u]);return p?r.a.createElement(r.a.Fragment,null,r.a.createElement(pe,{club:p,organisationID:c,onSubmit:function(){}})):r.a.createElement(r.a.Fragment,null,"loading...")},Ee=function(){var e=Object(i.i)().path;return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(e),exact:!0},r.a.createElement(se,null)),r.a.createElement(i.b,{path:"".concat(e,"/add")},r.a.createElement(ve,null)),r.a.createElement(i.b,{path:"".concat(e,"/:id")},r.a.createElement(fe,null)),r.a.createElement(i.a,{to:"".concat(e)}))},he=function(){var e=p({service:X}),t=Object(o.a)(e,2),a=t[0],n=t[1],c=a.map((function(e){return Object(W.a)(Object(W.a)({},e),{},{tacit:e.tacit?"oui":"non",type:ne(e.type)})})),l=[{Header:"Prix",accessor:"price"},{Header:"Description",accessor:"description"},{Header:"Type",accessor:"type"},{Header:"Tacite",accessor:"tacit"},{Header:"Action",accessor:"id",disableFilters:!0,disableSortBy:!0,Cell:function(e){return r.a.createElement(ge,{plan:e.row.values,refreshList:n})}}];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Gestion des abonnements"),r.a.createElement("div",{className:"row"},r.a.createElement(u.b,{to:"/admin/membershipPlans/add",className:"btn btn-primary"},"Ajouter"),r.a.createElement(U,{data:c,columns:l})))},ge=function(e){var t=e.plan,a=e.refreshList,n=function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,X.delete(t.id);case 4:e.sent&&a();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("tr",null,r.a.createElement("td",null,t.price),r.a.createElement("td",null,ne(t.type)),r.a.createElement("td",null,t.tacit?"oui":"non"),r.a.createElement("td",null,r.a.createElement(u.b,{to:"/admin/membershipPlans/update/".concat(t.id),className:"btn btn-primary"},"Modifier"),r.a.createElement("button",{className:"btn",onClick:function(e){return n(t)}},"Supprimer")))},Oe=function(e){var t=e.membershipPlan?Object(W.a)({},e.membershipPlan):{price:0,description:"",type:1,tacit:!1},a=p({service:X}),c=Object(o.a)(a,2),l=c[0],s=(c[1],Object(n.useState)(0)),m=Object(o.a)(s,2),v=m[0],f=m[1],E=Object(n.useState)(!1),h=Object(o.a)(E,2),g=h[0],O=h[1],y=Object(i.g)(),j=function(){var t=Object(b.a)(d.a.mark((function t(a,n){var r,c,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.setSubmitting,c=n.setFieldError,a.type=v,a.tacit=g,t.prev=3,!(null===(l=e.membershipPlan)||void 0===l?void 0:l.id)){t.next=9;break}return t.next=7,X.update(e.membershipPlan.id,a);case 7:t.next=12;break;case 9:return a.organisation={id:e.organisationID},t.next=12,X.add(Object(W.a)({},a));case 12:y.push("/admin/membershipPlans"),t.next=20;break;case 15:t.prev=15,t.t0=t.catch(3),console.error(t.t0),t.t0.message?c("global",t.t0.message):c("global","Erreur serveur..."),r(!1);case 20:case"end":return t.stop()}}),t,null,[[3,15]])})));return function(e,a){return t.apply(this,arguments)}}();return r.a.createElement("div",{id:"membershipPlanForm"},r.a.createElement(J.d,{initialValues:t,validate:function(e){var t={};return e.price||(t.price="Required"),t},onSubmit:j},(function(e){var t=e.isSubmitting,a=e.errors;return r.a.createElement(J.c,null,r.a.createElement("label",{htmlFor:"price"},"Prix"),r.a.createElement(J.b,{className:"form-control ".concat(a.price?"is-invalid":""),name:"price"}),r.a.createElement("label",{htmlFor:"type"},"Type"),r.a.createElement(J.b,{as:"select",name:"membershipSelect",onChange:function(e){var t;t=e.target.value,f(t)}},l.map((function(e,t){return r.a.createElement("option",{key:t,value:t},"".concat(e))}))),r.a.createElement("label",{htmlFor:"tacit"},"Tacite"),r.a.createElement(J.b,{as:"select",name:"tacitSelect",onChange:function(e){var t;t=e.target.value,O("true"===t)}},r.a.createElement("option",{value:"true"},"oui"),r.a.createElement("option",{value:"false"},"non")),r.a.createElement(de,{variant:"primary",type:"submit",disabled:t},"Sauver"),r.a.createElement(u.b,{to:"/admin/membershipPlans"},r.a.createElement(de,{variant:"secondary"},"Annuler")))})))},ye=function(e){var t=Object(n.useState)(0),a=Object(o.a)(t,2),c=a[0],l=a[1],u=Object(n.useState)(),s=Object(o.a)(u,2),m=s[0],p=s[1],v=Object(i.h)().id;return Object(n.useEffect)((function(){var e,t=j();(null===t||void 0===t||null===(e=t.organisation)||void 0===e?void 0:e.id)&&l(null===t||void 0===t?void 0:t.organisation.id),v&&function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getByID(v);case 2:(t=e.sent)&&p(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[v]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Ajout d'abonnement"),r.a.createElement("div",null,v?m?r.a.createElement(Oe,{organisationID:c,membershipPlan:m}):null:r.a.createElement(Oe,{organisationID:c})))},je=function(){var e=Object(i.i)().path;return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(e),exact:!0},r.a.createElement(he,null)),r.a.createElement(i.b,{path:"".concat(e,"/add")},r.a.createElement(ye,null)),r.a.createElement(i.b,{path:"".concat(e,"/update/:id")},r.a.createElement(ye,null)),r.a.createElement(i.a,{to:"".concat(e)}))},Ne=function(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.getAll();case 2:(t=e.sent)&&c(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Tag de membre"),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement(u.b,{to:"/admin/memberlabels/add",className:"btn btn-primary"},"Ajouter")),r.a.createElement("div",{className:"row"},r.a.createElement("table",{className:"table"},r.a.createElement("tbody",null,a.map((function(e){return r.a.createElement(we,{label:e,key:e.id})})))))))},we=function(e){var t=e.label;return r.a.createElement("tr",null,r.a.createElement("td",null,t.id),r.a.createElement("td",null,t.name),r.a.createElement("td",null,r.a.createElement(u.b,{to:"/admin/memberlabels/".concat(t.id)},"...")))},ke=function(e){var t={name:"",global:""};e.label&&(t=Object(W.a)(Object(W.a)({},t),e.label));var a=function(){var t=Object(b.a)(d.a.mark((function t(a,n){var r,c,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.setSubmitting,c=n.setFieldError,t.prev=1,!(null===(l=e.label)||void 0===l?void 0:l.id)){t.next=7;break}return t.next=5,K.update(e.label.id,a);case 5:t.next=9;break;case 7:return t.next=9,K.add(Object(W.a)(Object(W.a)({},a),{},{organisation:{id:e.organisationID}}));case 9:e.onSubmit(),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),console.error(t.t0),t.t0.message?c("global",t.t0.message):c("global","Erreur serveur...");case 16:r(!1);case 17:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e,a){return t.apply(this,arguments)}}();return r.a.createElement(J.d,{initialValues:t,validate:function(e){var t={};return e.name||(t.name="Required"),t},onSubmit:a},(function(e){var t=e.isSubmitting,a=e.errors;return r.a.createElement(J.c,null,r.a.createElement(J.a,{name:"global",component:function(e){return r.a.createElement(Y.a,{variant:"danger"},e.children)}}),r.a.createElement(Z,{formnikError:a.name,label:"Nom du tag",name:"name",type:"text"}),r.a.createElement(s.a,{variant:"primary",type:"submit",disabled:t},"Sauver"),r.a.createElement(u.b,{to:"/admin/memberlabels"},r.a.createElement(s.a,{variant:"secondary"},"Annuler")))}))},xe=function(e){var t=le(),a=Object(o.a)(t,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement(ke,{organisationID:a,onSubmit:function(){window.history.back()}}))},Se=function(e){var t=le(),a=Object(o.a)(t,1)[0],c=Object(i.h)().id,l=Object(n.useState)(null),u=Object(o.a)(l,2),s=u[0],m=u[1];Object(n.useEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.getByID(c);case 2:(null===(t=e.sent)||void 0===t?void 0:t.data)&&m(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[c]);return s?r.a.createElement(r.a.Fragment,null,r.a.createElement(ke,{label:s,organisationID:a,onSubmit:function(){window.history.back()}})):r.a.createElement(r.a.Fragment,null,"loading....")},Pe=function(){var e=Object(i.i)().path;return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(e),exact:!0},r.a.createElement(Ne,null)),r.a.createElement(i.b,{path:"".concat(e,"/add")},r.a.createElement(xe,null)),r.a.createElement(i.b,{path:"".concat(e,"/:id")},r.a.createElement(Se,null)),r.a.createElement(i.a,{to:"".concat(e)}))},Te=function(e){var t=e.title,a=e.children;return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},t),r.a.createElement("div",null,a)))},Ce=new(function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){return Object(v.a)(this,a),t.call(this,"dashboard")}return a}(F)),Fe=function(){var e=Object(n.useState)(null),t=Object(o.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.getAll();case 2:(t=e.sent)&&c(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),a?r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Tableau de bord"),r.a.createElement("hr",null),r.a.createElement("div",{className:"card-deck"},r.a.createElement(Te,{title:"Membres ayant leur anniversaire dans 7 jours: "+a.birthdays.length},r.a.createElement("ul",{className:"list-group"},a.birthdays.map((function(e){var t,a;return r.a.createElement("li",{className:"list-group-item"},r.a.createElement(u.b,{to:"/admin/members/".concat(e.id)},null===(t=e.user)||void 0===t?void 0:t.firstname," ",null===(a=e.user)||void 0===a?void 0:a.lastname))})))),r.a.createElement(Te,{title:"Membres ayant une balance n\xe9gative: "+a.negativeBalanceUsers.length},r.a.createElement("ul",{className:"list-group"},a.negativeBalanceUsers.map((function(e){var t,a;return r.a.createElement("li",{className:"list-group-item"},r.a.createElement(u.b,{to:"/admin/members/".concat(e.id)},null===(t=e.user)||void 0===t?void 0:t.firstname," ",null===(a=e.user)||void 0===a?void 0:a.lastname))})))))):r.a.createElement("div",null,"Loading...")},Ae=new(function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){return Object(v.a)(this,a),t.call(this,"memberships")}return Object(f.a)(a,[{key:"getNotPaid",value:function(){return P("memberships/notPaid")}}]),a}(F)),Ie=new(function(e){Object(Q.a)(a,e);var t=Object($.a)(a);function a(){return Object(v.a)(this,a),t.call(this,"payments")}return Object(f.a)(a,[{key:"createPaymentWithoutRequest",value:function(e){return T("payments/payment-without-request",e)}}]),a}(F)),De=new F("payment-requests"),Le=function(e){var t,a,c,l,u,i,s=e.memberShip,m=e.onPaymentReceivedFunction,p=Object(n.useState)(!1),v=Object(o.a)(p,2),f=v[0],E=v[1];Object(n.useEffect)((function(){s.paymentRequest&&E(!0)}),[s.paymentRequest]);var h=function(){var e=Object(b.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.plan){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,De.add({amount:t.plan.price,date:new Date,description:"demand\xe9 manuellement"});case 5:return a=e.sent,e.next=8,Ae.update(t.id,{paymentRequest:null===a||void 0===a?void 0:a.data});case 8:E(!0),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error("error on createPaymentRequest()",e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(b.a)(d.a.mark((function e(t){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.plan){e.next=2;break}return e.abrupt("return");case 2:if(a={amount:t.plan.price,date:new Date,hasBeenCanceled:!1},e.prev=3,!f){e.next=12;break}return a.paymentRequest=t.paymentRequest,a.member=t.member,e.next=9,Ie.add(a);case 9:n=e.sent,e.next=15;break;case 12:return e.next=14,Ie.createPaymentWithoutRequest({payment:a,memberShip:t});case 14:n=e.sent;case 15:n&&m(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),console.error(e.t0);case 21:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},null===(t=s.member)||void 0===t||null===(a=t.user)||void 0===a?void 0:a.firstname," ",null===(c=s.member)||void 0===c||null===(l=c.user)||void 0===l?void 0:l.lastname),r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},"Abonnement ",ne(null===(u=s.plan)||void 0===u?void 0:u.type),", \xe9chu le"," ",s.endDate),"prix : ",null===(i=s.plan)||void 0===i?void 0:i.price,".-",r.a.createElement("div",{className:"float-right"},r.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h(s));case 1:case"end":return e.stop()}}),e)}))),disabled:f},"Paiment demand\xe9"),r.a.createElement("button",{type:"button",className:"btn btn-success",onClick:Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(s));case 1:case"end":return e.stop()}}),e)})))},"Argent re\xe7u"))))},Re=function(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),a=t[0],c=t[1],l=function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ae.getNotPaid();case 2:t=e.sent,c(null===t||void 0===t?void 0:t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){l()}),[]);var u=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("h1",null,"Gestion de paiements"),a.map((function(e){return r.a.createElement(Le,{key:e.id,memberShip:e,onPaymentReceivedFunction:function(){u()}})})))},qe=function(){var e=Object(i.i)().path;return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(e),exact:!0},r.a.createElement(Re,null)),r.a.createElement(i.a,{to:"".concat(e)}))},Be=function(){var e=Object(i.i)().path;return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(e,"/"),exact:!0},r.a.createElement(Fe,null)),r.a.createElement(i.b,{path:"".concat(e,"/members")},r.a.createElement(oe,null)),r.a.createElement(i.b,{path:"".concat(e,"/clubs")},r.a.createElement(Ee,null)),r.a.createElement(i.b,{path:"".concat(e,"/dashboard")},r.a.createElement(Fe,null)),r.a.createElement(i.b,{path:"".concat(e,"/membershipPlans")},r.a.createElement(je,null)),r.a.createElement(i.b,{path:"".concat(e,"/payments")},r.a.createElement(qe,null)),r.a.createElement(i.b,{path:"".concat(e,"/memberlabels")},r.a.createElement(Pe,null)))},Ue=a(108),_e=a(61),He=(a(99),function(e){var t=Object(_e.useMediaQuery)({query:"(min-device-width: 992px)"}),a=Object(n.useState)(t),c=Object(o.a)(a,2),l=c[0],i=c[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"adminlayout"},r.a.createElement("div",{className:"navbar header flex-md-nowrap"},r.a.createElement("div",{className:"d-flex p-1 w-50"},r.a.createElement(s.a,{onClick:function(){i(!l)}},r.a.createElement("span",{"aria-label":"button",role:"img"},l?"\u2716":"\u2b1b")),r.a.createElement(u.b,{to:"/admin/dashboard",className:"navbar-brand col-md-3 col-lg-2 mr-0 px-3"},"Clug")),r.a.createElement("ul",{className:"navbar-nav p-1"},r.a.createElement("li",{className:"nav-item text-nowrap"},r.a.createElement(u.b,{className:"nav-link",to:"/logout"},"D\xe9connexion")))),r.a.createElement("div",{id:"main"},r.a.createElement(Ue.a,{className:"flex-column ".concat(l?"open":null),id:"sidenav"},[{displayName:"Tableau de bord",to:"/admin/dashboard"},{displayName:"Membres",to:"/admin/members"},{displayName:"Clubs",to:"/admin/clubs"},{displayName:"Abonnements",to:"/admin/membershipPlans"},{displayName:"Paiements",to:"/admin/payments"},{displayName:"Tag de membre",to:"/admin/memberlabels"}].map((function(e,a){return r.a.createElement(Ue.a.Link,{key:a,as:u.b,to:e.to,onClick:function(){t||i(!l)}},e.displayName)}))),r.a.createElement("div",{className:"container",id:"mainContent"},e.children))))}),Ge=(a(100),function(e){return r.a.createElement("div",{id:"basiclayout"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col main"},e.children))))});!function(e){e[e.INIT_APP=0]="INIT_APP",e[e.HAS_LOGIN=1]="HAS_LOGIN",e[e.LOGOUT=2]="LOGOUT"}(ae||(ae={}));var Me={isAuthentified:!1},Ve=r.a.createContext(null),We=function(e){var t=Object(n.useReducer)((function(e,t){switch(t.type){case ae.INIT_APP:return Object(W.a)(Object(W.a)({},e),{},{isAuthentified:null!==w()});case ae.HAS_LOGIN:return Object(W.a)(Object(W.a)({},e),{},{isAuthentified:!0});case ae.LOGOUT:return localStorage.clear(),Me;default:return e}}),Me),a=Object(o.a)(t,2),c=a[0],l=a[1];return Object(n.useEffect)((function(){return l({type:ae.INIT_APP})}),[]),r.a.createElement(Ve.Provider,{value:{state:c,dispatch:l}},e.children)},Je=Object(n.forwardRef)((function(e,t){var a=e.id,n=e.className,c=e.type,l=e.placeholder;return r.a.createElement("input",{ref:t,id:a,className:"form-control ".concat(n),type:c?"".concat(c):"text",placeholder:l})})),Ye=(a(101),function(){var e=Object(n.useState)(null),t=Object(o.a)(e,2),a=t[0],c=t[1],l=Object(n.useRef)(null),u=Object(n.useRef)(null),s=Object(n.useContext)(Ve);if(!s)return r.a.createElement(r.a.Fragment,null);if(s.state.isAuthentified)return r.a.createElement(i.a,{to:"/admin/dashboard"});var m=function(){var e=Object(b.a)(d.a.mark((function e(t){var a,n,r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,r=(null===(a=l.current)||void 0===a?void 0:a.value)?l.current.value:"",i=(null===(n=u.current)||void 0===n?void 0:n.value)?u.current.value:"",e.next=6,g(r,i);case 6:s.dispatch({type:ae.HAS_LOGIN}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error(e.t0),e.t0.message?c({message:e.t0.message}):c({message:"Erreur serveur..."});case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{onSubmit:m,className:"form login"},a?r.a.createElement(be,{variant:"danger"},a.message):null,r.a.createElement(Je,{ref:l,placeholder:"Nom d'utilisateur",type:"text",className:"input"}),r.a.createElement(Je,{ref:u,placeholder:"Mot de passe",type:"password",className:"input"}),r.a.createElement(de,{type:"submit",variant:"secondary"},"Se connecter"))}),ze=(a(102),a(65)),Ke=a.n(ze),Qe=function(e){var t=e.className;return r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{className:"logo ".concat(t),src:Ke.a,alt:"Clug logo"}))},$e=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{className:"login"}),r.a.createElement(Ye,null))},Xe=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Bienvenue sur Clug App"),r.a.createElement(u.b,{to:"/login"},"Login"))},Ze=function(){var e=Object(n.useContext)(Ve);return Object(n.useEffect)((function(){(null===e||void 0===e?void 0:e.state.isAuthentified)&&(null===e||void 0===e||e.dispatch({type:ae.LOGOUT}))}),[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"A bient\xf4t !"))},et=function(){return r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/",exact:!0},r.a.createElement(Ge,null,r.a.createElement(Xe,null))),r.a.createElement(i.b,{path:"/admin"},r.a.createElement(He,null,r.a.createElement(Be,null))),r.a.createElement(i.b,{path:"/login"},r.a.createElement(Ge,null,r.a.createElement($e,null))),r.a.createElement(i.b,{path:"/logout"},r.a.createElement(Ge,null,r.a.createElement(Ze,null))),r.a.createElement(i.b,null,r.a.createElement(Ge,null,r.a.createElement("h1",null,"404: Nothing to see here...."))))},tt=(a(55),function(e){return r.a.createElement(We,null,r.a.createElement(u.a,null,r.a.createElement(et,null)))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(tt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},55:function(e,t,a){},65:function(e,t,a){e.exports=a.p+"static/media/clug-logo-w.6bd58774.svg"},67:function(e,t,a){e.exports=a(103)},94:function(e,t,a){},99:function(e,t,a){}},[[67,1,2]]]);
//# sourceMappingURL=main.cb0115a3.chunk.js.map